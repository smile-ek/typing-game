<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>タイピングゲーム</title>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }
        .word, .romaji, #result, #questionCounter {
            font-size: 28px;
            margin: 20px 0;
            display: none;
        }
        .romaji span {
            letter-spacing: 5px;
        }
        .correct {
            color: green;
        }
        #startButton {
            font-size: 24px;
            padding: 10px 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h2>タイピングゲーム</h2>
    
    <button id="startButton">スタート</button>

    <p class="word" id="wordDisplay"></p>
    <p class="romaji" id="romajiDisplay"></p>
    <p id="result"></p>
    <p id="questionCounter"></p>

    <script>
        let questions = []; // 問題リスト
        let currentQuestion = {}; // 現在の問題
        let currentIndex = 0;
        let questionCount = 0; // 出題カウント
        const maxQuestions = 3; // 出題する問題数

        // JSONファイルを読み込む
        async function loadQuestions() {
            const response = await fetch("questions.json");
            questions = await response.json();
        }

        // ランダムな問題をセットする
        function setRandomQuestion() {
            if (questionCount >= maxQuestions) {
                document.getElementById("result").textContent = "ゲームクリア！";
                document.getElementById("questionCounter").textContent = "";
                return;
            }

            currentIndex = 0;
            currentQuestion = questions[Math.floor(Math.random() * questions.length)];
            questionCount++;

            // 画面に表示
            document.getElementById("wordDisplay").textContent = currentQuestion.question;
            document.getElementById("romajiDisplay").innerHTML = currentQuestion.answer
                .split("")
                .map(letter => `<span>${letter.toUpperCase()}</span>`)
                .join("");
            
            document.getElementById("questionCounter").textContent = `問題 ${questionCount} / ${maxQuestions}`;
            document.getElementById("result").textContent = ""; // 「正解！」を消す
        }

        // スタートボタンの処理
        document.getElementById("startButton").addEventListener("click", function() {
            document.getElementById("startButton").style.display = "none"; // ボタンを非表示
            document.getElementById("wordDisplay").style.display = "block";
            document.getElementById("romajiDisplay").style.display = "block";
            document.getElementById("result").style.display = "block";
            document.getElementById("questionCounter").style.display = "block";

            setRandomQuestion(); // ランダムな問題をセット
        });

        // タイピングの処理
        document.addEventListener("keydown", function(event) {
            if (!currentQuestion.answer) return; // 問題がセットされていないときは無視
            if (currentIndex >= currentQuestion.answer.length) return; // すでにクリアしていたら無視

            const key = event.key.toLowerCase();
            const targetLetter = currentQuestion.answer[currentIndex];

            if (key === targetLetter) {
                document.querySelectorAll("#romajiDisplay span")[currentIndex].classList.add("correct");
                currentIndex++;

                if (currentIndex === currentQuestion.answer.length) {
                    // すべての文字を入力したら「正解！」を表示
                    document.getElementById("result").textContent = "正解！";

                    // 1秒後に次の問題へ進む
                    setTimeout(() => {
                        setRandomQuestion(); // 次の問題へ
                    }, 1000);
                }
            }
        });

        // ゲーム開始時に問題をロード
        loadQuestions();
    </script>
</body>
</html>
